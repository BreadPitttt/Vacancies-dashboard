<!-- Report modal -->
<div id="report-modal" class="modal hidden" aria-hidden="true">
  <div class="modal-body">
    <div class="modal-head">
      <h3>Report Listing</h3>
      <button type="button" class="icon-btn" data-close>&times;</button>
    </div>
    <form id="reportForm" class="form">
      <input type="hidden" id="reportListingId" />
      <label>Reason</label>
      <select id="reportReasonCode" required>
        <option value="">Select a reason</option>
        <option value="expired">Last date over</option>
        <option value="wrong_deadline">Wrong last date</option>
        <option value="not_vacancy">Not a vacancy (result/exam date/admit card/syllabus)</option>
        <option value="ineligible_education">Wrong education eligibility</option>
        <option value="ineligible_domicile">Wrong domicile rule</option>
        <option value="technical_pg">Technical/PG/management role (exclude)</option>
        <option value="spam_duplicate">Duplicate/spam</option>
        <option value="broken_link">Broken/invalid link</option>
        <option value="other">Other</option>
      </select>
      <label>Official evidence URL (optional)</label>
      <input id="reportEvidenceUrl" placeholder="https://...gov.in/... (optional)" />
      <label>Note (optional)</label>
      <textarea id="reportNote" rows="3" placeholder="Any extra context"></textarea>
      <div class="row end">
        <button type="button" class="btn ghost" data-close>Close</button>
        <button type="submit" class="btn danger">Report</button>
      </div>
    </form>
  </div>
</div>
<script>
  // ... existing script remains; replace only the Report handler inside DOMContentLoaded:
  document.addEventListener("DOMContentLoaded", function(){
    // existing init...

    // Submit report (structured)
    document.querySelector("#reportForm")?.addEventListener("submit", async function(e){
      e.preventDefault();
      const id = document.querySelector("#reportListingId").value.trim();
      const reasonCode = document.querySelector("#reportReasonCode").value.trim();
      const evidence = document.querySelector("#reportEvidenceUrl").value.trim();
      const note = document.querySelector("#reportNote").value.trim();
      if(!reasonCode) return alert("Please select a reason.");
      const ok = await postJSON({
        type:"report",
        jobId:id,
        reasonCode,
        url:evidence,     // Worker already logs 'url' into reports.jsonl
        title: reasonCode, // keep backward-compat with qc_and_learn parsing
        note,
        ts:new Date().toISOString()
      });
      if(ok){
        closeModal(e.target);
        e.target.reset();
        alert("Reported.");
      }
    });

    // When clicking card "Report" button, pre-fill listing id (existing)
    // already handled where the card opens the modal and sets #reportListingId.
  });
</script>
